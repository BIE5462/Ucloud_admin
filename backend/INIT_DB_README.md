# 数据库初始化说明

## 初始化脚本

### 使用方法

#### 1. 全新初始化（删除所有现有数据）
```bash
python init_db.py
```

此命令会：
- 创建所有数据库表
- 删除所有现有数据
- 插入默认超级管理员
- 插入系统配置

#### 2. 保留现有数据（仅初始化缺失的数据）
```bash
python init_db.py --keep-data
```

此命令会：
- 创建所有数据库表（如果不存在）
- 保留现有数据
- 仅初始化缺失的超级管理员和系统配置

### 默认超级管理员账号

- **用户名**: `admin`
- **密码**: `admin123`
- **角色**: `super_admin`
- **初始余额**: ¥999,999.00

**⚠️ 警告**: 请尽快修改默认密码！

### 系统配置项

初始化后会自动创建以下配置：

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| `price_per_minute` | 0.5 | 云电脑每分钟价格（元） |
| `min_balance_to_start` | 2.5 | 启动云电脑所需最低余额（元） |
| `system_name` | 云电脑容器管理系统 | 系统名称 |
| `system_version` | 1.0.0 | 系统版本 |

### 数据库表结构

初始化脚本会创建以下表：

1. **m_admin** - 管理员表（代理模式）
2. **m_user** - 用户表
3. **container_record** - 容器记录表
4. **system_config** - 系统配置表
5. **billing_charge_record** - 实时扣费记录表
6. **container_log** - 容器操作日志表
7. **admin_operation_log** - 管理员操作日志表
8. **balance_log** - 余额变动日志表

### 注意事项

1. **生产环境**: 请务必修改默认超级管理员密码
2. **数据备份**: 在执行初始化前，如需保留数据请先备份数据库文件
3. **SQLite数据库**: 默认数据库文件为 `./cloud_pc.db`
4. **时区**: 所有时间字段使用 UTC 时间存储，前端显示时转换为北京时间

### 启动服务

初始化完成后，启动服务：

```bash
python run.py
```

API文档地址：
- http://localhost:8000/docs
- http://localhost:8000/redoc
